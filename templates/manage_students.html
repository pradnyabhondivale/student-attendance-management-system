{% extends "layout_admin.html" %}
{% block title %}Manage Students{% endblock %}
{% block content %}
<div class="main-header">
    <div class="header-text">
        <h2>Manage Students</h2>
        <p>Add, edit, or remove student accounts.</p>
    </div>
    <button class="btn-primary" onclick="openModal('addStudentModal')"><i class="ri-add-line"></i> Add Student</button>
</div>

<div class="widget">
    <div class="attendance-table">
        <table>
            <thead>
                <tr><th>Full Name</th><th>Email</th><th>Roll No.</th><th>Class</th><th>Actions</th></tr>
            </thead>
            <tbody>
                {% for student in students %}
                <tr id="user-row-{{ student.id }}">
                    <td data-label="name">{{ student.full_name }}</td>
                    <td data-label="email">{{ student.email }}</td>
                    <td data-label="roll">{{ student.roll_number or 'N/A' }}</td>
                    <td data-label="class">{{ student.class_name or 'N/A' }}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn-action edit" onclick="openEditModal({{ student.id }}, 'student')"><i class="ri-pencil-line"></i></button>
                            <form action="{{ url_for('delete_user', user_id=student.id) }}" method="POST" onsubmit="return confirm('Are you sure you want to delete this student? This will also remove all their attendance records.');">
                                <button type="submit" class="btn-action delete"><i class="ri-delete-bin-line"></i></button>
                            </form>
                        </div>
                    </td>
                </tr>
                {% else %}
                <tr><td colspan="5" class="no-records">No students found. Add one to get started.</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- Add Student Modal -->
<div id="addStudentModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Add New Student</h3>
            <span class="close-btn" onclick="closeModal('addStudentModal')">&times;</span>
        </div>
        <form action="{{ url_for('add_user') }}" method="POST">
            <input type="hidden" name="role" value="student">
            <div class="form-group"><label>Full Name</label><input type="text" name="full_name" required></div>
            <div class="form-group"><label>Email Address</label><input type="email" name="email" required></div>
            <div class="form-group"><label>Initial Password</label><input type="password" name="password" required></div>
            <div class="profile-form">
                <div class="form-group"><label>Roll Number</label><input type="text" name="roll_number"></div>
                <div class="form-group"><label>Class</label><input type="text" name="class_name"></div>
            </div>
            <div class="modal-footer">
                <button type="submit" class="btn-primary">Add Student</button>
            </div>
        </form>
    </div>
</div>

<!-- Edit User Modal (Generic for both students and faculty) -->
<div id="editModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Edit User Details</h3>
            <span class="close-btn" onclick="closeModal('editModal')">&times;</span>
        </div>
        <form id="editForm" action="{{ url_for('edit_user') }}" method="POST">
            <input type="hidden" id="editUserId" name="user_id">
            <input type="hidden" id="editUserRole" name="role">
            <div class="form-group"><label>Full Name</label><input type="text" id="editFullName" name="full_name" required></div>
            <div class="form-group"><label>Email Address</label><input type="email" id="editEmail" name="email" required></div>
            <div id="studentFields" class="profile-form">
                <div class="form-group"><label>Roll Number</label><input type="text" id="editRollNumber" name="roll_number"></div>
                <div class="form-group"><label>Class</label><input type="text" id="editClassName" name="class_name"></div>
            </div>
            <div class="modal-footer">
                <button type="submit" class="btn-primary">Save Changes</button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

s